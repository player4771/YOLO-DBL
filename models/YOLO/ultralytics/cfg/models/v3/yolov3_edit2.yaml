# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# Ultralytics YOLOv3 object detection model with P3/8 - P5/32 outputs
# Model docs: https://docs.ultralytics.com/models/yolov3
# Task docs: https://docs.ultralytics.com/tasks/detect

# Parameters
nc: 80 # number of classes
depth_multiple: 1.0 # model depth multiple
width_multiple: 1.0 # layer channel multiple


backbone: #edited backbone
  # [from, number, module, args]
  - [-1, 1, Conv, [32, 3, 1]] # 0
  - [-1, 1, Conv, [64, 3, 2]] # P1/2
  - [-1, 1, DSC3k2, [64, False, 0.5]]
  - [-1, 1, Conv, [128, 3, 2]] # P2/4
  - [-1, 2, DSC3k2, [128, False, 0.5]]
  - [-1, 1, Conv, [256, 3, 2]] # P3/8
  - [-1, 2, DSC3k2, [256, False, 0.5]]
  - [-1, 1, Conv, [512, 1, 1]] # è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é€‚é…å±‚ï¼Œè¾“å‡ºåªé€šå‘HyperACE
  - [-2, 1, DSConv, [512, 3, 2]] # P4/16, è¿™å±‚çš„è¾“å…¥æ˜¯ä¸Šä¸Šå±‚ï¼Œè·³è¿‡äº†ä¸Šä¸€å±‚çš„è¾“å‡º
  - [-1, 4, Bottleneck, [512, True]]
  - [-1, 1, DSConv, [1024, 3, 2]] # P5/32
  - [-1, 4, Bottleneck, [1024, True]] # 11


head:
  - [[-5, -3, -1], 2, HyperACE, [512, 8, True, True]] #ä¿®æ”¹äº†å¤„ç†é€»è¾‘ä½¿å¾—åé¢å‡ ä¸ªå‚æ•°å¯ç¼ºçœï¼Œè¯¦è§task.py/parse_model
  - [-1, 1, Conv, [512, 1, 2]] # é€‚é…ä¸‹ä¸€å±‚ï¼šåˆ†è¾¨ç‡å‡åŠï¼Œç»´åº¦åŠ å€
  - [-1, 1, Bottleneck, [512, False]]
  - [-1, 1, Conv, [1024, 3, 1]]
  - [-1, 1, Conv, [512, 1, 1]]
  - [-1, 1, Conv, [1024, 3, 1]] # (P5/32-large)

  - [-2, 1, Conv, [256, 1, 1]]
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
  - [[-1, 9], 1, Concat, [1]] # cat backbone P4
  - [-1, 1, Bottleneck, [512, False]]
  - [-1, 1, Bottleneck, [512, False]]
  - [-1, 1, Conv, [256, 1, 1]]
  - [-1, 1, Conv, [512, 3, 1]] # (P4/16-medium)

  - [-2, 1, Conv, [128, 1, 1]]
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
  - [[-1, 6], 1, Concat, [1]] # cat backbone P3
  - [-1, 1, Bottleneck, [256, False]]
  - [-1, 2, Bottleneck, [256, False]] # (P3/8-small)

  - [[17, 24, 29], 1, Detect, [nc]] # Detect(P3, P4, P5)
